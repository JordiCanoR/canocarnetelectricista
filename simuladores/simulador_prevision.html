
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Simulador Previsión de Cargas</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; }
    h1, h2 { background-color: #e0e0e0; padding: 10px; }
    input[type='text'], input[type='number'] { width: 300px; margin: 4px; padding: 4px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #333; padding: 6px; text-align: center; }
    .section { margin-top: 30px; }
</style>
</head>
<body>
<h1>PLANTILLA DE CÁLCULO DE CARGAS ELÉCTRICAS - REBT (Guía BT-10)</h1>

<!-- OMITIDO: las secciones de datos generales, viviendas, servicios, garajes, totales, etc. -->
<!-- IMPORTANTE: Las tablas de locales y oficinas deben tener id="tablaLocales" y id="tablaOficinas" respectivamente -->
<!-- Se asume que ya están bien colocadas en tu HTML -->

<script>
function agregarFilaVivienda() {
    const tabla = document.querySelector("table");
    const row = tabla.insertRow(-1);
    for (let i = 0; i < 4; i++) {
        const cell = row.insertCell(i);
        const input = document.createElement("input");
        input.type = i === 2 ? "text" : "number";
        input.placeholder = "";
        input.oninput = calcularViviendas;
        cell.appendChild(input);
    }
    calcularViviendas();
}

function calcularViviendas() {
    const tabla = document.querySelector("table");
    const rows = Array.from(tabla.rows).slice(1);
    let potenciaTotal = 0;
    let nViviendas = 0;

    rows.forEach(row => {
        const grado = row.cells[2].querySelector("input")?.value.trim().toLowerCase();
        let potencia = 0;
        if (grado === "básica" || grado === "basica") potencia = 5750;
        else if (grado === "elevada") potencia = 9200;

        if (potencia > 0) {
            nViviendas++;
            row.cells[3].querySelector("input").value = potencia;
            potenciaTotal += potencia;
        } else {
            row.cells[3].querySelector("input").value = "";
        }
    });

    const coef = obtenerCoefSimultaneidad(nViviendas);
    const resultado = document.getElementById("totalViviendas");
    if (resultado) resultado.value = (potenciaTotal * coef).toFixed(2);
}

function obtenerCoefSimultaneidad(n) {
    const tabla = {
        1: 1, 2: 3, 3: 3.8, 4: 4.6, 5: 5.4, 6: 6.2, 7: 7, 8: 7.8, 9: 8.5,
        10: 9.2, 11: 9.9, 12: 10.6, 13: 11.3, 14: 11.9, 15: 12.5,
        16: 13.1, 17: 13.7, 18: 14.3, 19: 14.8, 20: 15.3, 21: 15.3
    };
    if (n <= 21) return tabla[n] || 1;
    return 15.3 + (n - 21) * 0.5;
}

function agregarFila(idTabla) {
    const tabla = document.getElementById(idTabla);
    if (!tabla) return;
    const fila = tabla.insertRow(-1);
    const columnas = tabla.rows[0].cells.length;
    for (let i = 0; i < columnas; i++) {
        const celda = fila.insertCell(i);
        const input = document.createElement("input");
        input.type = i === 0 ? "text" : "number";
        input.placeholder = "";
        input.oninput = calcularTotales;
        celda.appendChild(input);
    }
    calcularTotales();
}

function calcularTotales() {
    calcularSeccion('tablaLocales', 'totalLocales');
    calcularSeccion('tablaOficinas', 'totalOficinas');
}

function calcularSeccion(tablaId, salidaId) {
    const tabla = document.getElementById(tablaId);
    const salida = document.getElementById(salidaId);
    if (!tabla || !salida) return;
    let total = 0;
    for (let i = 1; i < tabla.rows.length; i++) {
        const cells = tabla.rows[i].cells;
        const superficie = parseFloat(cells[1].querySelector("input")?.value || 0);
        const wpm = parseFloat(cells[2].querySelector("input")?.value || 0);
        total += superficie * wpm;
        if (cells[3] && cells[3].querySelector("input")) {
            cells[3].querySelector("input").value = (superficie * wpm).toFixed(2);
        }
    }
    salida.value = total.toFixed(2);
}

function calcularPotenciaGarajeArea() {
    const m2 = parseFloat(document.getElementById("superficieGaraje").value) || 0;
    const wpm2 = parseFloat(document.getElementById("wPorM2Garaje").value) || 0;
    const total = m2 * wpm2;
    document.getElementById("resultadoGarajeArea").value = total.toFixed(2);
}
</script>

</body>
</html>
